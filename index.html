<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Catan Helper - Cities & Knights Companion</title>
  <meta name="description" content="A mobile-friendly helper for Settlers of Catan: Cities & Knights. Track resources, see what you can build, and get progress card descriptions.">
  <meta name="theme-color" content="#722f37">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>âš”ï¸</text></svg>">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
  <style>
    :root {
      --parchment-light: #f4e4bc;
      --parchment-mid: #e8d4a8;
      --burgundy: #722f37;
      --burgundy-dark: #4a1f24;
      --gold: #c9a227;
      --text-dark: #2c1810;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Crimson Text', Georgia, serif;
      font-size: 18px;
      line-height: 1.6;
      color: var(--text-dark);
      background: linear-gradient(135deg, #2c1810 0%, #4a3628 50%, #2c1810 100%);
      min-height: 100vh;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 40px 20px;
    }

    .header {
      text-align: center;
      margin-bottom: 40px;
    }

    .title {
      font-family: 'Cinzel', serif;
      font-size: 2.5rem;
      color: var(--gold);
      text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
    }

    .subtitle {
      color: var(--parchment-light);
      font-style: italic;
      margin-top: 8px;
      font-size: 1.1rem;
    }

    .panel {
      background: linear-gradient(145deg, var(--parchment-light) 0%, var(--parchment-mid) 100%);
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
      border: 3px solid var(--burgundy);
    }

    h2 {
      font-family: 'Cinzel', serif;
      color: var(--burgundy);
      border-bottom: 2px solid var(--burgundy);
      padding-bottom: 10px;
      margin-bottom: 16px;
      font-size: 1.3rem;
    }

    .bookmarklet-link {
      display: inline-block;
      padding: 18px 36px;
      background: linear-gradient(180deg, var(--burgundy), var(--burgundy-dark));
      color: var(--gold);
      text-decoration: none;
      border-radius: 10px;
      font-family: 'Cinzel', serif;
      font-size: 1.3rem;
      font-weight: 600;
      border: 2px solid var(--gold);
      cursor: move;
      transition: transform 0.2s, box-shadow 0.2s;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
    }

    .bookmarklet-link:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.4);
    }

    .bookmarklet-container {
      text-align: center;
      padding: 30px;
      background: rgba(255,255,255,0.3);
      border-radius: 8px;
      margin: 20px 0;
    }

    .steps {
      counter-reset: step;
      padding-left: 0;
      list-style: none;
    }

    .steps li {
      position: relative;
      padding-left: 50px;
      margin-bottom: 20px;
    }

    .steps li::before {
      counter-increment: step;
      content: counter(step);
      position: absolute;
      left: 0;
      top: 0;
      width: 36px;
      height: 36px;
      background: var(--burgundy);
      color: var(--gold);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'Cinzel', serif;
      font-weight: bold;
    }

    code {
      background: rgba(0,0,0,0.1);
      padding: 2px 8px;
      border-radius: 4px;
      font-family: monospace;
      font-size: 0.9em;
      word-break: break-all;
    }

    .mobile-section {
      background: rgba(33,150,243,0.1);
      border: 2px solid #2196f3;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 16px;
    }

    .mobile-section h3 {
      color: #1565c0;
      margin-bottom: 12px;
      font-family: 'Cinzel', serif;
    }

    .mobile-section.android {
      border-color: #4caf50;
      background: rgba(76,175,80,0.1);
    }

    .mobile-section.android h3 {
      color: #2e7d32;
    }

    .mobile-steps {
      padding-left: 20px;
      margin: 0;
    }

    .mobile-steps li {
      margin-bottom: 10px;
    }

    .code-box {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 15px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 11px;
      overflow-x: auto;
      white-space: pre-wrap;
      word-break: break-all;
      margin: 15px 0;
      max-height: 120px;
      overflow-y: auto;
      user-select: all;
      -webkit-user-select: all;
    }

    .copy-btn {
      background: var(--burgundy);
      color: var(--gold);
      border: none;
      padding: 14px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-family: 'Cinzel', serif;
      font-size: 1rem;
      width: 100%;
      font-weight: 600;
      transition: background 0.2s;
    }

    .copy-btn:hover, .copy-btn:active {
      background: var(--burgundy-dark);
    }

    .features {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 16px;
      margin-top: 20px;
    }

    .feature {
      background: rgba(255,255,255,0.4);
      padding: 20px;
      border-radius: 8px;
      text-align: center;
    }

    .feature-icon {
      font-size: 2.2rem;
      margin-bottom: 8px;
    }

    .feature-title {
      font-family: 'Cinzel', serif;
      color: var(--burgundy);
      margin: 0 0 8px 0;
      font-size: 1rem;
    }

    .feature p {
      font-size: 0.9rem;
      margin: 0;
      opacity: 0.9;
    }

    .footer {
      text-align: center;
      color: var(--parchment-mid);
      padding: 20px;
      font-size: 0.9rem;
    }

    .footer a {
      color: var(--gold);
    }

    .tip {
      background: rgba(255,193,7,0.2);
      border: 1px solid #ffc107;
      padding: 12px 16px;
      border-radius: 8px;
      margin-top: 16px;
      font-size: 0.95rem;
    }

    .tip strong {
      color: #ff8f00;
    }

    @media (max-width: 600px) {
      .title { font-size: 1.8rem; }
      .panel { padding: 20px; }
      .steps li { padding-left: 45px; }
      .bookmarklet-link { padding: 14px 28px; font-size: 1.1rem; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header class="header">
      <h1 class="title">âš”ï¸ Catan Helper</h1>
      <p class="subtitle">Cities & Knights Companion Tool</p>
    </header>

    <section class="panel">
      <h2>ğŸ–¥ï¸ Desktop Installation</h2>
      <p>Drag this button to your bookmarks bar:</p>
      
      <div class="bookmarklet-container">
        <a class="bookmarklet-link" id="bookmarkletLink" href="#">
          âš”ï¸ Catan Helper
        </a>
      </div>

      <div class="tip">
        <strong>ğŸ’¡ Tip:</strong> Can't see your bookmarks bar? Press <code>Ctrl+Shift+B</code> (Windows) or <code>Cmd+Shift+B</code> (Mac) to show it.
      </div>
    </section>

    <section class="panel">
      <h2>ğŸ“± Mobile Installation</h2>
      
      <div class="mobile-section">
        <h3>ğŸ iPhone / Safari</h3>
        <ol class="mobile-steps">
          <li>Tap <strong>"Copy Code"</strong> below</li>
          <li>Bookmark any page (Share â†’ Add Bookmark)</li>
          <li>Open Bookmarks, find it, tap <strong>Edit</strong></li>
          <li>Delete the URL, <strong>paste the code</strong></li>
          <li>Save!</li>
        </ol>
      </div>

      <div class="mobile-section android">
        <h3>ğŸ¤– Android / Chrome</h3>
        <ol class="mobile-steps">
          <li>Tap <strong>"Copy Code"</strong> below</li>
          <li>Tap â‹® â†’ Bookmarks â†’ â‹® on any bookmark â†’ Edit</li>
          <li>Replace URL with <strong>pasted code</strong></li>
          <li>Or create new bookmark and paste as URL</li>
        </ol>
      </div>

      <div class="code-box" id="codeBox">Loading...</div>
      <button class="copy-btn" onclick="copyCode()">ğŸ“‹ COPY CODE</button>
    </section>

    <section class="panel">
      <h2>ğŸ® How to Use</h2>
      <ol class="steps">
        <li>
          <strong>Open your Catan game</strong><br>
          Go to your game at <code>g.csdu.co.uk</code>
        </li>
        <li>
          <strong>Activate the helper</strong><br>
          Click the bookmarklet (desktop) or type its name in the URL bar (mobile)
        </li>
        <li>
          <strong>View your dashboard</strong><br>
          See resources, building options, dev tracks & card descriptions
        </li>
      </ol>

      <div class="tip">
        <strong>ğŸ“± Mobile tip:</strong> The helper covers the full screen. Tap "Show Game" to see the board, run the bookmarklet again to bring back the helper.
      </div>
    </section>

    <section class="panel">
      <h2>âœ¨ Features</h2>
      <div class="features">
        <div class="feature">
          <div class="feature-icon">ğŸ“¦</div>
          <h3 class="feature-title">Resources</h3>
          <p>All resources & commodities at a glance</p>
        </div>
        <div class="feature">
          <div class="feature-icon">ğŸ›ï¸</div>
          <h3 class="feature-title">Dev Tracks</h3>
          <p>Trade, Science & Politics levels</p>
        </div>
        <div class="feature">
          <div class="feature-icon">ğŸ”¨</div>
          <h3 class="feature-title">Build Guide</h3>
          <p>See what you can afford to build</p>
        </div>
        <div class="feature">
          <div class="feature-icon">ğŸ“œ</div>
          <h3 class="feature-title">Card Info</h3>
          <p>Full descriptions of progress cards</p>
        </div>
      </div>
    </section>

    <footer class="footer">
      <p>âš”ï¸ Catan Helper â€¢ Not affiliated with Catan GmbH<br>
      <a href="https://github.com" target="_blank">View on GitHub</a></p>
    </footer>
  </div>

  <script>
    // Mobile-optimized bookmarklet code
    const bookmarkletCode = `javascript:(function(){if(!location.hostname.includes("csdu.co.uk")){alert("Open this on g.csdu.co.uk with your game!");return}var C={200:{n:"Alchemist",c:"science",i:"ğŸ§ª",d:"Choose dice result for resource production"},201:{n:"Crane",c:"science",i:"ğŸ—ï¸",d:"Build city improvement for 1 less commodity"},202:{n:"Engineer",c:"science",i:"âš™ï¸",d:"Build a city wall for free"},203:{n:"Inventor",c:"science",i:"ğŸ’¡",d:"Swap 2 number tokens (not 6, 8, 2, 12)"},204:{n:"Irrigation",c:"science",i:"ğŸ’§",d:"Each settlement on grain gets 2 grain"},205:{n:"Medicine",c:"science",i:"ğŸ’Š",d:"Upgrade settlement to city for 2 ore + 1 grain"},206:{n:"Mining",c:"science",i:"â›ï¸",d:"Each settlement on ore/mountains gets 2 ore"},207:{n:"Printer",c:"science",i:"ğŸ“°",d:"+1 Victory Point (keep until played)"},208:{n:"Road Building",c:"science",i:"ğŸ›¤ï¸",d:"Build 2 roads for free"},209:{n:"Smith",c:"science",i:"ğŸ”¨",d:"Promote 2 knights for free"},300:{n:"Commercial Harbor",c:"trade",i:"âš“",d:"Force opponents to give you 1 commodity each (1 per their VP)"},301:{n:"Master Merchant",c:"trade",i:"ğŸ©",d:"Look at opponent hand, take 2 cards"},302:{n:"Merchant",c:"trade",i:"ğŸ§‘â€ğŸ’¼",d:"Place merchant for 2:1 trade + 1 VP"},303:{n:"Merchant Fleet",c:"trade",i:"â›µ",d:"Trade any resource 2:1 this turn"},304:{n:"Resource Monopoly",c:"trade",i:"ğŸ’",d:"Name a resource, each player gives you 2"},305:{n:"Trade Monopoly",c:"trade",i:"ğŸ‘‘",d:"Name a commodity, each player gives you 1"},400:{n:"Bishop",c:"politics",i:"âœï¸",d:"Move robber, take 1 card from each adjacent player"},401:{n:"Constitution",c:"politics",i:"ğŸ“œ",d:"+1 Victory Point (keep until played)"},402:{n:"Deserter",c:"politics",i:"ğŸƒ",d:"Remove any opponent knight from the board"},403:{n:"Diplomat",c:"politics",i:"ğŸ¤",d:"Remove any open road (yours or opponent)"},404:{n:"Intrigue",c:"politics",i:"ğŸ—¡ï¸",d:"Displace opponent knight to move yours there"},405:{n:"Saboteur",c:"politics",i:"ğŸ’£",d:"All opponents with more VP discard half their hand"},406:{n:"Spy",c:"politics",i:"ğŸ•µï¸",d:"Look at opponent progress cards, steal 1"},407:{n:"Warlord",c:"politics",i:"âš”ï¸",d:"Activate all your knights for free"},408:{n:"Wedding",c:"politics",i:"ğŸ’’",d:"Each player with more VP gives you 2 cards"}};var B={road:{n:"Road",i:"ğŸ›£ï¸",c:{lumber:1,brick:1}},settlement:{n:"Settlement",i:"ğŸ ",c:{lumber:1,brick:1,wool:1,grain:1}},city:{n:"City",i:"ğŸ°",c:{grain:2,ore:3}},wall:{n:"City Wall",i:"ğŸ§±",c:{brick:2}},knight:{n:"Knight",i:"âš”ï¸",c:{wool:1,ore:1}},activate:{n:"Activate Knight",i:"ğŸ›¡ï¸",c:{grain:1}},promote:{n:"Strong Knight",i:"ğŸ’ª",c:{wool:1,ore:1}},mighty:{n:"Mighty Knight",i:"ğŸ¦¸",c:{wool:1,ore:1}}};var p=new URLSearchParams(location.search);var gid=p.get("game_id"),pid=parseInt(p.get("player_id"))||1;if(!gid){alert("No game_id found in URL!");return}var o=document.createElement("div");o.id="ch-overlay";o.innerHTML='<style>*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}#ch-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:#2c1810;font-family:-apple-system,system-ui,sans-serif;color:#f4e4bc;z-index:999999;overflow-y:auto;-webkit-overflow-scrolling:touch;padding:env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left)}.chW{max-width:500px;margin:0 auto;padding:16px}.chH{background:linear-gradient(180deg,#722f37,#4a1f24);color:#c9a227;padding:16px;border-radius:12px;display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;position:sticky;top:0;z-index:10}.chH h1{margin:0;font-size:20px;font-weight:700}.chTog{background:#c9a227;color:#2c1810;border:0;padding:10px 16px;border-radius:8px;font-weight:600;font-size:14px}.chS{background:rgba(244,228,188,.1);border-radius:12px;padding:16px;margin-bottom:16px}.chT{font-weight:700;color:#c9a227;font-size:16px;margin-bottom:12px;display:flex;align-items:center;gap:8px}.chR{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;text-align:center}.chRi{background:rgba(255,255,255,.1);padding:12px 4px;border-radius:8px}.chRn{font-size:24px;display:block}.chRv{font-weight:700;font-size:18px;display:block;margin:4px 0}.chRl{font-size:11px;opacity:.8}.chCm{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:12px}.chDv{display:flex;flex-direction:column;gap:12px}.chDt{display:flex;align-items:center;gap:10px}.chDl{font-size:14px;width:80px;font-weight:600}.chDb{flex:1;height:28px;background:rgba(0,0,0,.3);border-radius:14px;overflow:hidden;position:relative}.chDf{height:100%;border-radius:14px}.chDf.trade{background:linear-gradient(90deg,#c2b44b,#ffeb3b)}.chDf.science{background:linear-gradient(90deg,#2e7d32,#66bb6a)}.chDf.politics{background:linear-gradient(90deg,#1565c0,#42a5f5)}.chDn{position:absolute;right:10px;top:50%;transform:translateY(-50%);font-size:14px;font-weight:700;color:#fff;text-shadow:1px 1px 2px rgba(0,0,0,.5)}.chB{display:flex;flex-direction:column;gap:8px}.chBi{padding:14px;border-radius:10px;display:flex;align-items:center;gap:12px;font-size:15px}.chBi.y{background:rgba(76,175,80,.25);border:2px solid #4caf50}.chBi.n{background:rgba(255,255,255,.05);border:2px solid rgba(255,255,255,.1);opacity:.5}.chBi .icon{font-size:24px;width:36px;text-align:center}.chBi .info{flex:1}.chBi .name{font-weight:600}.chBi .cost{font-size:12px;opacity:.7;margin-top:2px}.chBi .status{font-size:20px}.chCd{display:flex;flex-direction:column;gap:10px}.chCi{padding:14px;border-radius:10px;border-left:4px solid}.chCi.science{border-color:#66bb6a;background:rgba(102,187,106,.15)}.chCi.trade{border-color:#ffeb3b;background:rgba(255,235,59,.1)}.chCi.politics{border-color:#42a5f5;background:rgba(66,165,245,.15)}.chCh{display:flex;gap:10px;align-items:center;margin-bottom:6px}.chCh .icon{font-size:22px}.chCn{font-weight:700;font-size:15px}.chCd-desc{font-size:13px;opacity:.9;line-height:1.4}.chPi{display:flex;align-items:center;gap:14px;padding:14px;background:rgba(255,255,255,.1);border-radius:10px;margin-bottom:16px}.chPc{width:48px;height:48px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:24px;color:#fff;font-weight:700}.chPn{font-size:18px;font-weight:600}.chPclr{font-size:14px;opacity:.8}</style><div class="chW"><div class="chH"><h1>âš”ï¸ Catan Helper</h1><button class="chTog" onclick="document.getElementById(\\'ch-overlay\\').style.display=\\'none\\'">Show Game</button></div><div id="chContent"><div style="text-align:center;padding:40px">Loading game data...</div></div></div>';var existing=document.getElementById("ch-overlay");if(existing){existing.style.display=existing.style.display==="none"?"block":"none";return}document.body.appendChild(o);var ws=new WebSocket("wss://fern-service.csdu.co.uk/socket/websocket?vsn=2.0.0");var ref=0,jref;ws.onopen=function(){jref=String(++ref);ws.send(JSON.stringify([jref,String(++ref),"catan_game:"+gid,"phx_join",{client_id:"CH_"+Math.random().toString(36).substr(2,5)}]))};ws.onmessage=function(e){try{var m=JSON.parse(e.data);if(m[3]==="phx_reply"&&m[4].status==="ok"&&m[1]==="2"){setTimeout(function(){ws.send(JSON.stringify([jref,String(++ref),"catan_game:"+gid,"game_state",""]))},500)}else if(m[3]==="game_state"&&m[4].game_state){render(m[4].game_state)}}catch(x){console.error(x)}};ws.onerror=function(){document.getElementById("chContent").innerHTML="<div style=\\'text-align:center;padding:40px\\'>Connection error. Make sure you are in an active game.</div>"};function render(gs){var pl=gs.players.find(function(x){return x.id===pid})||gs.players[0];var ck=pl.cities_knights||{};var r={lumber:pl.lumber||0,brick:pl.brick||0,wool:pl.wool||0,grain:pl.grain||0,ore:pl.ore||0,cloth:ck.cloth||0,coin:ck.coin||0,paper:ck.paper||0};var tLv=ck.trade||0,sLv=ck.science||0,pLv=ck.politics||0;var clr={Red:"#c24b4b",Blue:"#4b7bc2",Green:"#4bc24b",Yellow:"#c2b44b",Orange:"#c2824b",Brown:"#8b6b4b"};var h="<div class=\\'chPi\\'><div class=\\'chPc\\' style=\\'background:"+(clr[pl.colour]||"#666")+"\\'>"+((pl.colour||"?")[0])+"</div><div><div class=\\'chPn\\'>Player "+pl.id+"</div><div class=\\'chPclr\\'>"+pl.colour+"</div></div></div>";h+="<div class=\\'chS\\'><div class=\\'chT\\'>ğŸ“¦ Resources</div><div class=\\'chR\\'>";h+="<div class=\\'chRi\\'><span class=\\'chRn\\'>ğŸªµ</span><span class=\\'chRv\\'>"+r.lumber+"</span><span class=\\'chRl\\'>Wood</span></div>";h+="<div class=\\'chRi\\'><span class=\\'chRn\\'>ğŸ§±</span><span class=\\'chRv\\'>"+r.brick+"</span><span class=\\'chRl\\'>Brick</span></div>";h+="<div class=\\'chRi\\'><span class=\\'chRn\\'>ğŸ‘</span><span class=\\'chRv\\'>"+r.wool+"</span><span class=\\'chRl\\'>Wool</span></div>";h+="<div class=\\'chRi\\'><span class=\\'chRn\\'>ğŸŒ¾</span><span class=\\'chRv\\'>"+r.grain+"</span><span class=\\'chRl\\'>Grain</span></div>";h+="<div class=\\'chRi\\'><span class=\\'chRn\\'>ğŸª¨</span><span class=\\'chRv\\'>"+r.ore+"</span><span class=\\'chRl\\'>Ore</span></div></div>";h+="<div class=\\'chCm\\'><div class=\\'chRi\\'><span class=\\'chRn\\'>ğŸ§¶</span><span class=\\'chRv\\'>"+r.cloth+"</span><span class=\\'chRl\\'>Cloth</span></div>";h+="<div class=\\'chRi\\'><span class=\\'chRn\\'>ğŸª™</span><span class=\\'chRv\\'>"+r.coin+"</span><span class=\\'chRl\\'>Coin</span></div>";h+="<div class=\\'chRi\\'><span class=\\'chRn\\'>ğŸ“œ</span><span class=\\'chRv\\'>"+r.paper+"</span><span class=\\'chRl\\'>Paper</span></div></div></div>";h+="<div class=\\'chS\\'><div class=\\'chT\\'>ğŸ›ï¸ Development Tracks</div><div class=\\'chDv\\'>";h+="<div class=\\'chDt\\'><span class=\\'chDl\\'>ğŸŸ¡ Trade</span><div class=\\'chDb\\'><div class=\\'chDf trade\\' style=\\'width:"+(tLv*20)+"%\\'></div><span class=\\'chDn\\'>"+tLv+"/5</span></div></div>";h+="<div class=\\'chDt\\'><span class=\\'chDl\\'>ğŸŸ¢ Science</span><div class=\\'chDb\\'><div class=\\'chDf science\\' style=\\'width:"+(sLv*20)+"%\\'></div><span class=\\'chDn\\'>"+sLv+"/5</span></div></div>";h+="<div class=\\'chDt\\'><span class=\\'chDl\\'>ğŸ”µ Politics</span><div class=\\'chDb\\'><div class=\\'chDf politics\\' style=\\'width:"+(pLv*20)+"%\\'></div><span class=\\'chDn\\'>"+pLv+"/5</span></div></div></div></div>";h+="<div class=\\'chS\\'><div class=\\'chT\\'>ğŸ”¨ Build Options</div><div class=\\'chB\\'>";function canBuild(costs){for(var k in costs){if((r[k]||0)<costs[k])return false}return true}function costStr(costs){var s=[];for(var k in costs){var icons={lumber:"ğŸªµ",brick:"ğŸ§±",wool:"ğŸ‘",grain:"ğŸŒ¾",ore:"ğŸª¨",cloth:"ğŸ§¶",coin:"ğŸª™",paper:"ğŸ“œ"};s.push(costs[k]+(icons[k]||k))}return s.join(" ")}for(var k in B){var b=B[k],ok=canBuild(b.c);h+="<div class=\\'chBi "+(ok?"y":"n")+"\\'><span class=\\'icon\\'>"+b.i+"</span><div class=\\'info\\'><div class=\\'name\\'>"+b.n+"</div><div class=\\'cost\\'>"+costStr(b.c)+"</div></div><span class=\\'status\\'>"+(ok?"âœ…":"âŒ")+"</span></div>"}var nxtT=tLv+1,nxtS=sLv+1,nxtP=pLv+1;if(tLv<5){var okT=r.cloth>=nxtT;h+="<div class=\\'chBi "+(okT?"y":"n")+"\\'><span class=\\'icon\\'>ğŸŸ¡</span><div class=\\'info\\'><div class=\\'name\\'>Trade â†’ Level "+nxtT+"</div><div class=\\'cost\\'>"+nxtT+"ğŸ§¶ Cloth</div></div><span class=\\'status\\'>"+(okT?"âœ…":"âŒ")+"</span></div>"}if(sLv<5){var okS=r.paper>=nxtS;h+="<div class=\\'chBi "+(okS?"y":"n")+"\\'><span class=\\'icon\\'>ğŸŸ¢</span><div class=\\'info\\'><div class=\\'name\\'>Science â†’ Level "+nxtS+"</div><div class=\\'cost\\'>"+nxtS+"ğŸ“œ Paper</div></div><span class=\\'status\\'>"+(okS?"âœ…":"âŒ")+"</span></div>"}if(pLv<5){var okP=r.coin>=nxtP;h+="<div class=\\'chBi "+(okP?"y":"n")+"\\'><span class=\\'icon\\'>ğŸ”µ</span><div class=\\'info\\'><div class=\\'name\\'>Politics â†’ Level "+nxtP+"</div><div class=\\'cost\\'>"+nxtP+"ğŸª™ Coin</div></div><span class=\\'status\\'>"+(okP?"âœ…":"âŒ")+"</span></div>"}h+="</div></div>";var cds=ck.progress_cards||[];h+="<div class=\\'chS\\'><div class=\\'chT\\'>ğŸ“œ Progress Cards ("+cds.length+")</div><div class=\\'chCd\\'>";if(cds.length===0){h+="<div style=\\'opacity:.6;text-align:center;padding:20px\\'>No progress cards yet</div>"}for(var i=0;i<cds.length;i++){var cd=C[cds[i]]||{n:"Unknown",c:"science",i:"â“",d:"Unknown card"};h+="<div class=\\'chCi "+cd.c+"\\'><div class=\\'chCh\\'><span class=\\'icon\\'>"+cd.i+"</span><span class=\\'chCn\\'>"+cd.n+"</span></div><div class=\\'chCd-desc\\'>"+cd.d+"</div></div>"}h+="</div></div>";h+="<div style=\\'padding:20px 0;text-align:center\\'><button onclick=\\'location.reload()\\' style=\\'background:#722f37;color:#c9a227;border:0;padding:16px 32px;border-radius:10px;font-size:16px;font-weight:600\\'>ğŸ”„ Refresh Data</button></div>";document.getElementById("chContent").innerHTML=h}})();`;

    // Set the bookmarklet href
    document.getElementById('bookmarkletLink').href = bookmarkletCode;
    document.getElementById('codeBox').textContent = bookmarkletCode;

    function copyCode() {
      navigator.clipboard.writeText(bookmarkletCode).then(() => {
        alert('âœ… Code copied!\\n\\nNow create a bookmark and paste this as the URL.');
      }).catch(() => {
        // Fallback for older browsers / iOS
        const ta = document.createElement('textarea');
        ta.value = bookmarkletCode;
        ta.style.cssText = 'position:fixed;opacity:0;top:0;left:0';
        document.body.appendChild(ta);
        ta.focus();
        ta.select();
        try {
          document.execCommand('copy');
          alert('âœ… Code copied!\\n\\nNow create a bookmark and paste this as the URL.');
        } catch(e) {
          prompt('Copy this code manually:', bookmarkletCode);
        }
        document.body.removeChild(ta);
      });
    }
  </script>
</body>
</html>
